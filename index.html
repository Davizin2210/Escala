<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escala de Louvor</title>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* =====================================================
   VARI√ÅVEIS ‚Äì MODO CLARO
===================================================== */
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --primary:#22c55e;
  --secondary:#e5e7eb;
  --danger:#ef4444;
  --text:#020617;
  --border:#cbd5e1;
}

/* =====================================================
   RESET
===================================================== */
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

/* =====================================================
   BODY
===================================================== */
body{
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* =====================================================
   APP
===================================================== */
#app{
  max-width:520px;
  margin:auto;
  padding:20px;
}

/* =====================================================
   HEADER
===================================================== */
header{
  text-align:center;
  font-size:24px;
  font-weight:bold;
  margin-bottom:20px;
}

/* =====================================================
   BOT√ïES
===================================================== */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  margin-bottom:10px;
}

.btn-primary{background:var(--primary)}
.btn-secondary{background:var(--secondary)}
.btn-danger{background:var(--danger);color:#fff}

/* =====================================================
   CARD
===================================================== */
.card{
  background:var(--card);
  border:2px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}

.card.selected{
  border-color:var(--primary);
}

/* =====================================================
   TEXTOS
===================================================== */
.card h4{
  color:#16a34a;
  margin-bottom:6px;
}

.info{
  font-size:12px;
  margin-bottom:3px;
}

/* =====================================================
   A√á√ïES
===================================================== */
.actions{
  display:flex;
  gap:12px;
  margin-top:8px;
}

.actions span{
  font-size:11px;
  cursor:pointer;
}

.edit{color:#0284c7}
.delete{color:#dc2626}
.restore{color:#16a34a}

/* =====================================================
   BOT√ÉO GERAR IMAGEM
===================================================== */
#btnPrint{
  position:fixed;
  bottom:20px;
  left:5%;
  width:90%;
  display:none;
  z-index:100;
}

/* =====================================================
   FORMUL√ÅRIO
===================================================== */
#form{
  position:fixed;
  inset:0;
  background:var(--bg);
  padding:20px;
  display:none;
  overflow:auto;
}

input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
  margin-bottom:8px;
}

/* =====================================================
   LINHA
===================================================== */
.row{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}

/* =====================================================
   √ÅREA DE IMAGEM
===================================================== */
#printArea{
  position:absolute;
  left:-9999px;
  top:0;
  display:flex;
  gap:12px;
  padding:12px;
  background:white;
}

#printArea .card{
  width:220px;
  font-size:11px;
}
</style>
</head>

<body>

<div id="app">
  <header>üé∂ Escala de Louvor</header>

  <button class="btn-primary" onclick="abrirForm()">‚ûï Nova Escala</button>
  <button class="btn-secondary" onclick="ativarSelecao()">üñºÔ∏è Gerar Imagem</button>
  <button class="btn-danger" onclick="alternarLixeira()">üóëÔ∏è Lixeira</button>

  <h3 id="status">Escalas Salvas</h3>
  <div id="lista"></div>
</div>

<button id="btnPrint" class="btn-primary" onclick="gerarImagem()">SALVAR IMAGEM (0/10)</button>

<!-- =====================================================
     FORMUL√ÅRIO
===================================================== -->
<div id="form">

  <h2>Criar / Editar Escala</h2>

  <div class="row">
    <button class="btn-secondary" onclick="definirDia('TER√áA')">TER√áA</button>
    <button class="btn-secondary" onclick="definirDia('DOMINGO')">DOMINGO</button>
  </div>

  <div id="equipes" style="display:none">
    <button class="btn-primary" onclick="preencherEquipe('A')">Equipe A</button>
    <button class="btn-primary" onclick="preencherEquipe('B')">Equipe B</button>
  </div>

  <input id="dia" placeholder="Dia" readonly>
  <input id="ministro" placeholder="Ministro">

  <div id="vocais"></div>

  <input id="guitarra" placeholder="Guitarra">
  <input id="violao" placeholder="Viol√£o">
  <input id="baixo" placeholder="Baixo">
  <input id="teclado" placeholder="Teclado">
  <input id="bateria" placeholder="Bateria">

  <button class="btn-primary" onclick="salvarEscala()">Salvar</button>
  <button class="btn-secondary" onclick="fecharForm()">Voltar</button>

</div>

<div id="printArea"></div>

<script>
/* =====================================================
   REFER√äNCIAS DOM
===================================================== */
const lista = document.getElementById('lista');
const statusText = document.getElementById('status');
const btnPrint = document.getElementById('btnPrint');
const printArea = document.getElementById('printArea');
const vocaisDiv = document.getElementById('vocais');
const equipesDiv = document.getElementById('equipes');

/* =====================================================
   VARI√ÅVEIS
===================================================== */
let escalas = JSON.parse(localStorage.getItem('escalas')) || [];
let lixeira = JSON.parse(localStorage.getItem('lixeira')) || [];
let selecionados = [];
let modoSelecao = false;
let editIndex = null;
let mostrandoLixeira = false;

/* =====================================================
   STORAGE
===================================================== */
function salvarStorage(){
  localStorage.setItem('escalas',JSON.stringify(escalas));
  localStorage.setItem('lixeira',JSON.stringify(lixeira));
}

/* =====================================================
   FORM
===================================================== */
function abrirForm(){
  document.getElementById('form').style.display='block';
}

function fecharForm(){
  document.getElementById('form').style.display='none';
  editIndex=null;
}

/* =====================================================
   DIA
===================================================== */
function definirDia(diaEscolhido){
  document.getElementById('dia').value=diaEscolhido;
  vocaisDiv.innerHTML='';
  equipesDiv.style.display = diaEscolhido==='TER√áA' ? 'block' : 'none';

  for(let i=1;i<=7;i++){
    vocaisDiv.innerHTML += `<input id="v${i}" placeholder="Vocal ${i}">`;
  }
}

/* =====================================================
   EQUIPES
===================================================== */
function preencherEquipe(tipo){
  const equipeA=['Ellen','Fernanda','Nilza','Oscar','Raquel','Sabrina','Samuel'];
  const equipeB=['Alessandro','Alexandre','Al√©xia','Ana','Cl√°udia','Idelma','Rosane'];
  const dados = tipo==='A'?equipeA:equipeB;

  dados.forEach((nome,i)=>{
    const campo = document.getElementById(`v${i+1}`);
    if(campo) campo.value = nome;
  });
}

/* =====================================================
   SALVAR
===================================================== */
function salvarEscala(){
  const vocais = [];

  for(let i=1;i<=7;i++){
    const campo = document.getElementById(`v${i}`);
    vocais.push(campo ? campo.value : '');
  }

  const escala = {
    dia: document.getElementById('dia').value || '',
    ministro: ministro.value || '',
    vocais: vocais, // GARANTIDO
    guitarra: guitarra.value || '',
    violao: violao.value || '',
    baixo: baixo.value || '',
    teclado: teclado.value || '',
    bateria: bateria.value || ''
  };

  if(editIndex !== null){
    escalas[editIndex] = escala;
  } else {
    escalas.push(escala);
  }

  salvarStorage();
  fecharForm();
  render();
}


/* =====================================================
   RENDER
===================================================== */
function render(){
  lista.innerHTML='';
  statusText.innerText = mostrandoLixeira ? 'Lixeira' : 'Escalas Salvas';
  const dados = mostrandoLixeira ? lixeira : escalas;

  dados.forEach((e,i)=>{
    const card=document.createElement('div');
    card.className='card'+(selecionados.includes(i)?' selected':'');
    card.onclick=()=>toggleSelecao(i);

    card.innerHTML=`
      <h4>${e.dia}</h4>
      <div class="info">Ministro: ${e.ministro}</div>
     ${(e.vocais || []).map((v,idx)=>`
  <div class="info">Vocal ${idx+1}: ${v}</div>
`).join('')}

      <div class="info">Guitarra: ${e.guitarra}</div>
      <div class="info">Viol√£o: ${e.violao}</div>
      <div class="info">Baixo: ${e.baixo}</div>
      <div class="info">Teclado: ${e.teclado}</div>
      <div class="info">Bateria: ${e.bateria}</div>
      <div class="actions">
        ${!mostrandoLixeira
          ? `<span class="edit" onclick="event.stopPropagation();editarEscala(${i})">Editar</span>
             <span class="delete" onclick="event.stopPropagation();excluirEscala(${i})">Excluir</span>`
          : `<span class="restore" onclick="event.stopPropagation();restaurarEscala(${i})">Restaurar</span>`
        }
      </div>
    `;
    lista.appendChild(card);
  });
}

/* =====================================================
   CRUD
===================================================== */
function editarEscala(i){
  const e = escalas[i];
  editIndex=i;
  abrirForm();
  definirDia(e.dia);

  ministro.value=e.ministro;
  guitarra.value=e.guitarra;
  violao.value=e.violao;
  baixo.value=e.baixo;
  teclado.value=e.teclado;
  bateria.value=e.bateria;

  e.vocais.forEach((v,idx)=>{
    const campo=document.getElementById(`v${idx+1}`);
    if(campo) campo.value=v;
  });
}

function excluirEscala(i){
  lixeira.push(escalas[i]);
  escalas.splice(i,1);
  salvarStorage();
  render();
}

function restaurarEscala(i){
  escalas.push(lixeira[i]);
  lixeira.splice(i,1);
  salvarStorage();
  render();
}

function alternarLixeira(){
  mostrandoLixeira=!mostrandoLixeira;
  render();
}

/* =====================================================
   SELE√á√ÉO
===================================================== */
function ativarSelecao(){
  modoSelecao=true;
  selecionados=[];
  btnPrint.style.display='block';
  btnPrint.innerText='SALVAR IMAGEM (0/10)';
}

function toggleSelecao(i){
  if(!modoSelecao) return;

  if(selecionados.includes(i)){
    selecionados=selecionados.filter(x=>x!==i);
  }else if(selecionados.length<10){
    selecionados.push(i);
  }

  btnPrint.innerText=`SALVAR IMAGEM (${selecionados.length}/10)`;
  render();
}

/* =====================================================
   GERAR IMAGEM
===================================================== */
async function gerarImagem(){
  if(selecionados.length===0){
    alert('Selecione ao menos uma escala');
    return;
  }

  printArea.innerHTML='';

  selecionados.forEach(i=>{
    const clone=document.querySelectorAll('.card')[i].cloneNode(true);
    clone.classList.remove('selected');
    printArea.appendChild(clone);
  });

  printArea.style.width = (selecionados.length*232)+'px';

  await new Promise(r=>setTimeout(r,300));

  html2canvas(printArea,{scale:2}).then(canvas=>{
    const a=document.createElement('a');
    a.href=canvas.toDataURL('image/png');
    a.download='escala-louvor.png';
    a.click();
  });

  modoSelecao=false;
  selecionados=[];
  btnPrint.style.display='none';
  render();
}

/* =====================================================
   INIT
===================================================== */
render();
</script>

</body>
</html>
