<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escala de Louvor - Liquid Glass</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root {
  --bg: #e2e8f0;
  --glass: rgba(255, 255, 255, 0.4);
  --glass-border: rgba(255, 255, 255, 0.6);
  --primary: rgba(34, 197, 94, 0.7);
  --danger: rgba(239, 68, 68, 0.7);
  --text: #1e293b;
  --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
  background: linear-gradient(135deg, #cfd9df 0%, #e2ebf0 100%);
  background-attachment: fixed;
  color: var(--text);
  min-height: 100vh;
}

#app {
  max-width: 520px;
  margin: auto;
  padding: 24px;
}

header {
  text-align: center;
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 30px;
  letter-spacing: -0.5px;
}

button {
  width: 100%;
  padding: 16px;
  border: 1px solid var(--glass-border);
  border-radius: 18px;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: var(--shadow);
  color: var(--text);
  font-size: 15px;
}

button:active {
  transform: scale(0.96);
  background: rgba(255, 255, 255, 0.2);
}

.btn-primary {
  background: var(--primary);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
}

.btn-secondary {
  background: var(--glass);
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.card {
  background: var(--glass);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
  border-radius: 24px;
  padding: 18px;
  margin-bottom: 16px;
  box-shadow: var(--shadow);
  transition: transform 0.2s;
}

.card.selected {
  border: 3px solid #22c55e;
  transform: scale(1.02);
}

.card h4 {
  color: #065f46;
  font-size: 18px;
  margin-bottom: 10px;
}

.info {
  font-size: 13px;
  margin-bottom: 5px;
  opacity: 0.9;
}

.actions {
  display: flex;
  gap: 15px;
  margin-top: 12px;
  border-top: 1px solid rgba(0,0,0,0.05);
  padding-top: 12px;
}

.actions span {
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
}

.edit { color: #0369a1; }
.delete { color: #b91c1c; }
.restore { color: #15803d; }

#btnPrint {
  position: fixed;
  bottom: 25px;
  left: 5%;
  width: 90%;
  display: none;
  z-index: 100;
  background: rgba(34, 197, 94, 0.9);
  border-radius: 20px;
}

#form {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  padding: 24px;
  display: none;
  overflow: auto;
  z-index: 1000;
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: 1px solid var(--glass-border);
  margin-bottom: 10px;
  background: rgba(255, 255, 255, 0.5);
  font-size: 16px;
  outline: none;
}

input:focus {
  border-color: #22c55e;
  background: white;
}

.row {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
}

#printArea {
  position: absolute;
  left: -9999px;
  top: 0;
  display: grid;
  grid-template-columns: repeat(5, 220px);
  gap: 12px;
  padding: 20px;
  background: #fff;
}

#printArea .card {
  width: 220px;
  font-size: 11px;
  background: white;
  border: 1px solid #ddd;
  backdrop-filter: none;
}
</style>
</head>

<body>

<div id="app">
  <header>üé∂ Escala de Louvor</header>

  <button class="btn-primary" onclick="abrirForm()">‚ûï Nova Escala</button>
  <button class="btn-secondary" onclick="ativarSelecao()">üñºÔ∏è Gerar Imagem</button>
  <button class="btn-danger" onclick="alternarLixeira()">üóëÔ∏è Lixeira</button>

  <h3 id="status" style="margin: 20px 0 10px 5px; font-size: 14px; opacity: 0.6;">Escalas Salvas</h3>
  <div id="lista"></div>
</div>

<button id="btnPrint" class="btn-primary" onclick="gerarImagem()">SALVAR IMAGEM (0/10)</button>

<div id="form">
  <h2 style="margin-bottom: 20px; letter-spacing: -1px;">Criar / Editar Escala</h2>

  <div class="row">
    <button class="btn-secondary" onclick="definirDia('TER√áA')">TER√áA</button>
    <button class="btn-secondary" onclick="definirDia('DOMINGO')">DOMINGO</button>
  </div>

  <div id="equipes" style="display:none; margin-bottom: 15px;">
    <p style="font-size: 12px; margin-bottom: 8px; font-weight: bold;">Sugest√£o de Equipes:</p>
    <div class="row">
        <button class="btn-primary" onclick="preencherEquipe('A')">Equipe A</button>
        <button class="btn-primary" onclick="preencherEquipe('B')">Equipe B</button>
    </div>
  </div>

  <input id="dia" placeholder="Dia selecionado" readonly>
  <input id="ministro" placeholder="Nome do Ministro">

  <div id="vocais"></div>

  <input id="guitarra" placeholder="Guitarra">
  <input id="violao" placeholder="Viol√£o">
  <input id="baixo" placeholder="Baixo">
  <input id="teclado" placeholder="Teclado">
  <input id="bateria" placeholder="Bateria">

  <div style="margin-top: 20px;">
    <button class="btn-primary" onclick="salvarEscala()">Salvar Altera√ß√µes</button>
    <button class="btn-secondary" onclick="fecharForm()">Voltar</button>
  </div>
</div>

<div id="printArea"></div>

<script>
const lista = document.getElementById('lista');
const statusText = document.getElementById('status');
const btnPrint = document.getElementById('btnPrint');
const printArea = document.getElementById('printArea');
const vocaisDiv = document.getElementById('vocais');
const equipesDiv = document.getElementById('equipes');

let escalas = JSON.parse(localStorage.getItem('escalas')) || [];
let lixeira = JSON.parse(localStorage.getItem('lixeira')) || [];
let selecionados = [];
let modoSelecao = false;
let editIndex = null;
let mostrandoLixeira = false;

function salvarStorage(){
  localStorage.setItem('escalas',JSON.stringify(escalas));
  localStorage.setItem('lixeira',JSON.stringify(lixeira));
}

function abrirForm(){
  document.getElementById('form').style.display='block';
}

function fecharForm(){
  document.getElementById('form').style.display='none';
  editIndex=null;
}

function definirDia(diaEscolhido){
  document.getElementById('dia').value=diaEscolhido;
  vocaisDiv.innerHTML='';
  equipesDiv.style.display = diaEscolhido==='TER√áA' ? 'block' : 'none';

  for(let i=1;i<=7;i++){
    vocaisDiv.innerHTML += `<input id="v${i}" placeholder="Vocal ${i}">`;
  }
}

function preencherEquipe(tipo){
  const equipeA=['Ellen','Fernanda','Nilza','Oscar','Raquel','Sabrina','Samuel'];
  const equipeB=['Alessandro','Alexandre','Al√©xia','Ana','Cl√°udia','Idelma','Rosane'];
  const dados = tipo==='A'?equipeA:equipeB;

  dados.forEach((nome,i)=>{
    const campo = document.getElementById(`v${i+1}`);
    if(campo) campo.value = nome;
  });
}

function salvarEscala(){
  const vocais = [];
  for(let i=1;i<=7;i++){
    const campo = document.getElementById(`v${i}`);
    vocais.push(campo ? campo.value : '');
  }

  const escala = {
    dia: document.getElementById('dia').value || '',
    ministro: ministro.value || '',
    vocais: vocais,
    guitarra: guitarra.value || '',
    violao: violao.value || '',
    baixo: baixo.value || '',
    teclado: teclado.value || '',
    bateria: bateria.value || ''
  };

  if(editIndex !== null){
    escalas[editIndex] = escala;
  } else {
    escalas.push(escala);
  }

  salvarStorage();
  fecharForm();
  render();
}

function render(){
  lista.innerHTML='';
  statusText.innerText = mostrandoLixeira ? 'Lixeira' : 'Escalas Salvas';
  const dados = mostrandoLixeira ? lixeira : escalas;

  dados.forEach((e,i)=>{
    const card=document.createElement('div');
    card.className='card'+(selecionados.includes(i)?' selected':'');
    card.onclick=()=>toggleSelecao(i);

    card.innerHTML=`
      <h4>${e.dia}</h4>
      <div class="info"><strong>Ministro:</strong> ${e.ministro}</div>
      ${(e.vocais || []).filter(v => v !== '').map((v,idx)=>`
        <div class="info">Vocal: ${v}</div>
      `).join('')}
      <div class="info">Guit: ${e.guitarra} | Viol√£o: ${e.violao}</div>
      <div class="info">Baixo: ${e.baixo} | Tecl: ${e.teclado} | Bat: ${e.bateria}</div>
      <div class="actions">
        ${!mostrandoLixeira
          ? `<span class="edit" onclick="event.stopPropagation();editarEscala(${i})">Editar</span>
             <span class="delete" onclick="event.stopPropagation();excluirEscala(${i})">Excluir</span>`
          : `<span class="restore" onclick="event.stopPropagation();restaurarEscala(${i})">Restaurar</span>`
        }
      </div>
    `;
    lista.appendChild(card);
  });
}

function editarEscala(i){
  const e = escalas[i];
  editIndex=i;
  abrirForm();
  definirDia(e.dia);

  ministro.value=e.ministro;
  guitarra.value=e.guitarra;
  violao.value=e.violao;
  baixo.value=e.baixo;
  teclado.value=e.teclado;
  bateria.value=e.bateria;

  e.vocais.forEach((v,idx)=>{
    const campo=document.getElementById(`v${idx+1}`);
    if(campo) campo.value=v;
  });
}

function excluirEscala(i){
  lixeira.push(escalas[i]);
  escalas.splice(i,1);
  salvarStorage();
  render();
}

function restaurarEscala(i){
  escalas.push(lixeira[i]);
  lixeira.splice(i,1);
  salvarStorage();
  render();
}

function alternarLixeira(){
  mostrandoLixeira=!mostrandoLixeira;
  render();
}

function ativarSelecao(){
  modoSelecao=true;
  selecionados=[];
  btnPrint.style.display='block';
  btnPrint.innerText='SALVAR IMAGEM (0/10)';
}

function toggleSelecao(i){
  if(!modoSelecao) return;
  if(selecionados.includes(i)){
    selecionados=selecionados.filter(x=>x!==i);
  }else if(selecionados.length<10){
    selecionados.push(i);
  }
  btnPrint.innerText=`SALVAR IMAGEM (${selecionados.length}/10)`;
  render();
}

async function gerarImagem(){
  if(selecionados.length===0){
    alert('Selecione ao menos uma escala');
    return;
  }

  printArea.innerHTML='';
  selecionados.forEach(i=>{
    const clone=document.querySelectorAll('.card')[i].cloneNode(true);
    clone.classList.remove('selected');
    printArea.appendChild(clone);
  });

  const colunas = Math.min(selecionados.length, 5);
  printArea.style.width = (colunas * 232) + 'px';

  await new Promise(r=>setTimeout(r,500));

  html2canvas(printArea,{scale:2}).then(canvas=>{
    const a=document.createElement('a');
    a.href=canvas.toDataURL('image/png');
    a.download='escala-louvor.png';
    a.click();
  });

  modoSelecao=false;
  selecionados=[];
  btnPrint.style.display='none';
  render();
}

render();
</script>

</body>
</html>
