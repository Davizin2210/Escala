<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Louvor - Glass Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.15);
            --glass-heavy: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
            --primary: #22c55e;
            --accent: #60a5fa;
            --danger: #ef4444;
            --text: #ffffff;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body {
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        #app { max-width: 600px; margin: auto; padding: 20px; }

        header {
            text-align: center;
            padding: 40px 0;
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .nav-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 30px;
        }

        button {
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .btn-main { background: var(--glass); }
        .btn-primary { background: var(--primary); border: none; }
        .btn-danger { background: rgba(239, 68, 68, 0.3); }

        .card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: 0.3s;
        }

        .card.selected {
            border: 2px solid var(--primary);
            background: rgba(34, 197, 94, 0.1);
            transform: translateY(-5px);
        }

        .card h4 { font-size: 20px; margin-bottom: 12px; color: var(--primary); }

        .info-row {
            font-size: 14px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        #form {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            display: none;
            overflow-y: auto;
            z-index: 2000;
        }

        input {
            width: 100%;
            padding: 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: white;
            margin-bottom: 10px;
            outline: none;
        }

        /* Área de Impressão Oculta */
        #printArea {
            position: fixed;
            left: -9999px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .print-header {
            width: 100%;
            background-color: #7092be;
            color: white;
            text-align: center;
            padding: 15px 0;
            font-size: 28px;
            font-weight: bold;
        }

        .print-grid { display: flex; flex-wrap: nowrap; padding: 10px; gap: 2px; }

        .print-card {
            width: 160px;
            padding: 15px 10px;
            font-size: 12px;
            min-height: 450px;
            color: black;
            border: 1px solid #ddd;
        }

        .p-label { color: #c00000; font-weight: bold; margin-right: 4px; }
        .p-vocal-principal { color: #0070c0; font-weight: bold; margin-top: 10px; margin-bottom: 5px; }

        #floating-print-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            z-index: 3000;
            display: none;
            border-radius: 50px;
        }
    </style>
</head>
<body>

<div id="app">
    <header>LOUVOR</header>

    <div class="nav-actions">
        <button class="btn-main" onclick="abrirForm()"><i class="fa-solid fa-plus"></i>NOVO</button>
        <button class="btn-main" onclick="ativarSelecao()"><i class="fa-solid fa-image"></i>IMAGEM</button>
        <button class="btn-main btn-danger" onclick="alternarLixeira()"><i class="fa-solid fa-trash-can"></i>LIXEIRA</button>
    </div>

    <h3 id="status" style="margin-bottom:15px; font-size: 14px; color: var(--accent);">
        <i class="fa-solid fa-layer-group"></i> ESCALAS ATIVAS
    </h3>
    <div id="lista"></div>
</div>

<button id="floating-print-btn" class="btn-primary" onclick="gerarImagem()">
    GERAR IMAGEM AGORA (<span id="count">0</span>/10)
</button>

<div id="form">
    <h2 style="margin-bottom: 25px;">Configurar Escala</h2>
    
    <div style="display: flex; gap:10px; margin-bottom: 20px;">
        <button class="btn-main" style="flex:1" onclick="definirDia('DOMINGO')">DOMINGO</button>
        <button class="btn-main" style="flex:1" onclick="definirDia('TERÇA')">TERÇA</button>
    </div>

    <div id="equipes" style="display:none; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px;">
        <p style="font-size: 12px; margin-bottom: 10px;">Sugestão de Equipe:</p>
        <div style="display: flex; gap:10px;">
            <button class="btn-main" style="flex:1; background: var(--primary);" onclick="preencherEquipe('A')">EQUIPE A</button>
            <button class="btn-main" style="flex:1; background: var(--primary);" onclick="preencherEquipe('B')">EQUIPE B</button>
        </div>
    </div>

    <input id="dia" placeholder="Dia da Semana" readonly>
    <input id="data" placeholder="Data (DD/MM/AAAA)">
    <input id="ministro" placeholder="Vocal Líder (Ministro)">

    <div id="vocais"></div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <input id="guitarra" placeholder="Guitarra">
        <input id="violao" placeholder="Violão">
        <input id="baixo" placeholder="Baixo">
        <input id="teclado" placeholder="Teclado">
        <input id="bateria" placeholder="Bateria" style="grid-column: span 2;">
    </div>

    <div style="margin-top: 30px; display: flex; gap: 10px;">
        <button class="btn-primary" style="flex: 2; height: 50px;" onclick="salvarEscala()">SALVAR</button>
        <button class="btn-main" style="flex: 1; height: 50px;" onclick="fecharForm()">CANCELAR</button>
    </div>
</div>

<div id="printArea"></div>

<script>
    let escalas = JSON.parse(localStorage.getItem('escalas')) || [];
    let lixeira = JSON.parse(localStorage.getItem('lixeira')) || [];
    let selecionados = [];
    let modoSelecao = false;
    let editIndex = null;
    let mostrandoLixeira = false;

    function salvarStorage(){
        localStorage.setItem('escalas', JSON.stringify(escalas));
        localStorage.setItem('lixeira', JSON.stringify(lixeira));
    }

    function abrirForm(){
        document.getElementById('form').style.display = 'block';
    }

    function fecharForm(){
        document.getElementById('form').style.display = 'none';
        editIndex = null;
        limparCampos();
    }

    function limparCampos() {
        ['dia', 'data', 'ministro', 'guitarra', 'violao', 'baixo', 'teclado', 'bateria'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.value = '';
        });
        document.getElementById('vocais').innerHTML = '';
        document.getElementById('equipes').style.display = 'none';
    }

    function definirDia(diaEscolhido){
        document.getElementById('dia').value = diaEscolhido;
        const vocaisDiv = document.getElementById('vocais');
        vocaisDiv.innerHTML = '';
        document.getElementById('equipes').style.display = diaEscolhido === 'TERÇA' ? 'block' : 'none';

        for(let i=1; i<=6; i++){
            vocaisDiv.innerHTML += `<input id="v${i}" placeholder="Vocal ${i}">`;
        }
    }

    function preencherEquipe(tipo){
        const eqA = ['Ellen','Fernanda','Nilza','Oscar','Raquel','Sabrina'];
        const eqB = ['Alessandro','Alexandre','Aléxia','Ana','Cláudia','Idelma'];
        const dados = tipo === 'A' ? eqA : eqB;
        dados.forEach((nome, i) => {
            const campo = document.getElementById(`v${i+1}`);
            if(campo) campo.value = nome;
        });
    }

    function salvarEscala(){
        const vocais = [];
        for(let i=1; i<=6; i++){
            const v = document.getElementById(`v${i}`);
            if(v && v.value) vocais.push(v.value);
        }

        const escala = {
            dia: document.getElementById('dia').value,
            data: document.getElementById('data').value,
            ministro: document.getElementById('ministro').value,
            vocais: vocais,
            guitarra: document.getElementById('guitarra').value,
            violao: document.getElementById('violao').value,
            baixo: document.getElementById('baixo').value,
            teclado: document.getElementById('teclado').value,
            bateria: document.getElementById('bateria').value
        };

        if(!escala.dia || !escala.data) return alert("Preencha ao menos o dia e a data!");

        if(editIndex !== null) escalas[editIndex] = escala;
        else escalas.push(escala);

        salvarStorage();
        fecharForm();
        render();
    }

    function render(){
        const lista = document.getElementById('lista');
        const statusText = document.getElementById('status');
        lista.innerHTML = '';
        
        statusText.innerHTML = mostrandoLixeira ? '<i class="fa-solid fa-trash-can"></i> LIXEIRA' : '<i class="fa-solid fa-layer-group"></i> ESCALAS ATIVAS';
        
        const dados = mostrandoLixeira ? lixeira : escalas;

        dados.forEach((e, i) => {
            const card = document.createElement('div');
            card.className = `card ${selecionados.includes(i) ? 'selected' : ''}`;
            card.onclick = () => toggleSelecao(i);

            card.innerHTML = `
                <div class="card-actions">
                    ${!mostrandoLixeira ? `
                        <i class="fa-solid fa-pen" onclick="event.stopPropagation(); editarEscala(${i})"></i>
                        <i class="fa-solid fa-trash" onclick="event.stopPropagation(); excluirEscala(${i})"></i>
                    ` : `
                        <i class="fa-solid fa-rotate-left" onclick="event.stopPropagation(); restaurarEscala(${i})"></i>
                    `}
                </div>
                <h4>${e.data || '---'} - ${e.dia}</h4>
                <div class="info-row"><i class="fa-solid fa-microphone-lines"></i> <b>${e.ministro}</b></div>
                <div class="info-row"><i class="fa-solid fa-users"></i> ${e.vocais.join(', ')}</div>
            `;
            lista.appendChild(card);
        });
    }

    function editarEscala(i){
        const e = escalas[i];
        editIndex = i;
        abrirForm();
        definirDia(e.dia);
        document.getElementById('data').value = e.data || '';
        document.getElementById('ministro').value = e.ministro || '';
        document.getElementById('guitarra').value = e.guitarra || '';
        document.getElementById('violao').value = e.violao || '';
        document.getElementById('baixo').value = e.baixo || '';
        document.getElementById('teclado').value = e.teclado || '';
        document.getElementById('bateria').value = e.bateria || '';
        
        setTimeout(() => {
            e.vocais.forEach((v, idx) => {
                const campo = document.getElementById(`v${idx+1}`);
                if(campo) campo.value = v;
            });
        }, 10);
    }

    function excluirEscala(i){
        lixeira.push(escalas[i]);
        escalas.splice(i, 1);
        salvarStorage();
        render();
    }

    function restaurarEscala(i){
        escalas.push(lixeira[i]);
        lixeira.splice(i, 1);
        salvarStorage();
        render();
    }

    function alternarLixeira(){
        mostrandoLixeira = !mostrandoLixeira;
        render();
    }

    function ativarSelecao(){
        modoSelecao = !modoSelecao;
        selecionados = [];
        document.getElementById('floating-print-btn').style.display = modoSelecao ? 'block' : 'none';
        render();
    }

    function toggleSelecao(i){
        if(!modoSelecao) return;
        const idx = selecionados.indexOf(i);
        if(idx > -1) selecionados.splice(idx, 1);
        else if(selecionados.length < 10) selecionados.push(i);
        
        document.getElementById('count').innerText = selecionados.length;
        render();
    }

    async function gerarImagem() {
        if (selecionados.length === 0) return alert('Selecione as escalas primeiro!');

        const mes = prompt("Digite o título da imagem (ex: DEZEMBRO/2025):", "ESCALA DE LOUVOR");
        const printArea = document.getElementById('printArea');
        printArea.innerHTML = '';

        const header = document.createElement('div');
        header.className = 'print-header';
        header.innerText = mes;
        printArea.appendChild(header);

        const grid = document.createElement('div');
        grid.className = 'print-grid';
        printArea.appendChild(grid);

        const cores = [
            { bg: '#f8f9fa', text: '#000' },
            { bg: '#ffffff', text: '#000' },
            { bg: '#e7f1ff', text: '#000' },
            { bg: '#f0fff4', text: '#000' }
        ];

        selecionados.forEach((idx, i) => {
            const e = escalas[idx];
            const cor = cores[i % cores.length];
            const card = document.createElement('div');
            card.className = 'print-card';
            card.style.backgroundColor = cor.bg;

            card.innerHTML = `
                <div style="font-weight: bold; font-size: 16px;">${e.data}</div>
                <div style="margin-bottom: 10px; text-transform: uppercase; font-size: 11px;">${e.dia}</div>
                
                <div class="p-vocal-principal"><span class="p-label">Vocal Líder:</span><br>${e.ministro}</div>
                
                <div style="margin-bottom: 15px;">
                    <span class="p-label">Vozes:</span><br>
                    ${e.vocais.map(v => `<div>${v}</div>`).join('')}
                </div>

                <div style="margin-top: auto; border-top: 1px solid #eee; pt: 5px;">
                    <div><span class="p-label">Guitarra:</span> ${e.guitarra || '-'}</div>
                    <div><span class="p-label">Violão:</span> ${e.violao || '-'}</div>
                    <div><span class="p-label">Baixo:</span> ${e.baixo || '-'}</div>
                    <div><span class="p-label">Teclado:</span> ${e.teclado || '-'}</div>
                    <div><span class="p-label">Bateria:</span> ${e.bateria || '-'}</div>
                </div>
            `;
            grid.appendChild(card);
        });

        await new Promise(r => setTimeout(r, 500));

        html2canvas(printArea, { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `Escala_${mes}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            ativarSelecao();
        });
    }

    render();
</script>
</body>
</html>
